{"version":3,"file":"TextMessage.js","sourceRoot":"","sources":["../../../../../bb-models/src/TextMessage/TextMessage.ts"],"names":[],"mappings":"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","sourcesContent":["import {ICarrier} from \"./ICarrier\";\r\nimport {NodeMailer} from \"../../../bb-models/src/Error/NodeMailer\";\r\nimport {IMessageOptions} from \"../../../bb-models/src/Error/Interfaces/IMessageOptions\";\r\nimport {ISmtpOptions} from \"../../../bb-models/src/Error/Interfaces/ISmtpOptions\";\r\nimport {TCarrier} from \"./TCarrier\";\r\n\r\nexport class TextMessage {\r\n\tpublic static USCarriers: ICarrier[] = [\r\n\t\t{\r\n\t\t\t\"name\": <TCarrier> \"att\",\r\n\t\t\t\"domain\": \"txt.att.net\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": <TCarrier> \"tmobile\",\r\n\t\t\t\"domain\": \"tmomail.net\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": <TCarrier> \"verizon\",\r\n\t\t\t\"domain\": \"vtext.com\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": <TCarrier> \"cricket\",\r\n\t\t\t\"domain\": \"sms.mycricket.com\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": <TCarrier> \"uscellular\",\r\n\t\t\t\"domain\": \"email.uscc.net\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": <TCarrier> \"virginmobile\",\r\n\t\t\t\"domain\": \"vmobl.com\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": <TCarrier> \"boostmobile\",\r\n\t\t\t\"domain\": \"myboostmobile.com\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": <TCarrier> \"metropcs\",\r\n\t\t\t\"domain\": \"mymetropcs.com\"\r\n\t\t}\r\n\t];\r\n\tcarrier: TCarrier;\r\n\tdomain: string;\r\n\tprivate _mailService: NodeMailer;\r\n\tmsgOptions: IMessageOptions;\r\n\tsmtpOptions: ISmtpOptions;\r\n\r\n\tprivate _getCarrierEmailAddress(phoneNumber?: number): string {\r\n\t\treturn `${phoneNumber}@${this.domain}`;\r\n\t}\r\n\r\n\tpublic async send(subject: string, message: string, recipientPhone: number): Promise<void> {\r\n\t\tlet sentEmail: any;\r\n\t\ttry {\r\n\t\t\tthis.msgOptions.to = this._getCarrierEmailAddress(recipientPhone);\r\n\t\t\tthis.msgOptions.subject = message;\r\n\t\t\tthis.msgOptions.text = message;\r\n\t\t\tsentEmail = await this._mailService.sendEmail(this.msgOptions);\r\n\t\t\treturn sentEmail;\r\n\t\t} catch (err) {\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async sendError(error: Error, recipientPhone: number, source?: string){\r\n\t\tlet subject: string;\r\n\t\tlet srcMsg: string;\r\n\t\tlet isFatal: boolean;\r\n\t\tlet hasHandler: boolean;\r\n\r\n\t\tif(!error){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.msgOptions.text = error.message;\r\n\t\tthis.msgOptions.subject = `${(isFatal) ? \"Fatal\" : \"\"}${(hasHandler) ? error['handler'].type : \"Unknown\"} Error Received`;\r\n\r\n\t\tif (typeof error['isFatal'] === \"boolean\" || (typeof error['handler'] === \"function\")) {\r\n\t\t\tisFatal = error['isFatal'];\r\n\t\t\thasHandler = !!(error['handler'].type);\r\n\t\t}\r\n\t\tif(source){\r\n\t\t\tsrcMsg = `\\nSource: ${source}`;\r\n\t\t\tthis.msgOptions.text += srcMsg;\r\n\t\t}\r\n\t\tawait this.send(this.msgOptions.subject, this.msgOptions.text, recipientPhone);\r\n\t}\r\n\r\n\tconstructor(carrierName: TCarrier, smtpOpts: ISmtpOptions) {\r\n\t\tthis.msgOptions = <IMessageOptions>{};\r\n\t\tif(!smtpOpts || !smtpOpts.auth || !smtpOpts.auth.user || !smtpOpts.auth.pass){\r\n\t\t\tthrow new Error(\"Creating a new TextMessage requires email options with a username and password.\");\r\n\t\t}\r\n\t\tthis.msgOptions.from = smtpOpts.auth.user;\r\n\t\tthis.smtpOptions = smtpOpts;\r\n\t\tthis.carrier = carrierName;\r\n\t\tlet matchedCarrier: ICarrier[] = TextMessage.USCarriers.filter(d => {\r\n\t\t\treturn (d.name === carrierName);\r\n\t\t});\r\n\t\tif (matchedCarrier && matchedCarrier.length > 0) {\r\n\t\t\tlet match: ICarrier = matchedCarrier[0];\r\n\t\t\tthis.domain = match.domain;\r\n\t\t\tthis.carrier = match.name;\r\n\t\t} else {\r\n\t\t\tthrow new Error(`${carrierName} not found`);\r\n\t\t}\r\n\t\tthis._mailService = new NodeMailer(this.smtpOptions);\r\n\t}\r\n}"]}