{
  "version": 3,
  "file": "ErrorHandler.js",
  "sourceRoot": "",
  "sources": [
    "../../src/Error/ErrorHandler.ts"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "import {EMethod} from \"../Rest/EMethod\";\r\nimport {BotHttp} from \"../Rest/BotHttp\";\r\nimport {NodeMailer} from \"./Email/NodeMailer\";\r\nimport {IServiceOptions} from \"./Email/Interfaces/IServiceOprtions\";\r\nimport {IMessageOptions} from \"./Email/Interfaces/IMessageOptions\";\r\nimport {BinanceError} from \"./BinanceError\";\r\nimport {HttpError} from \"./HttpError\";\r\nimport {EErrorType} from \"./Email/Enums/EErrorType\";\r\n\r\nexport class ErrorHandler {\r\n\tpublic static allItems: ErrorHandler[];\r\n\tcode: number;\r\n\temailAddress?: string;\r\n\temailOptions?: IServiceOptions;\r\n\tprivate static emailService: NodeMailer;\r\n\tendpoint: string;\r\n\tmethod: EMethod;\r\n\tport: number;\r\n\trestart: boolean;\r\n\tsendEmail: boolean;\r\n\tshutdown: boolean;\r\n\ttimeout: number;\r\n\ttype: EErrorType;\r\n\tprotected url: string;\r\n\r\n\tpublic static GetErrorHandler(code: number, type: EErrorType): ErrorHandler {\r\n\t\tlet result: ErrorHandler;\r\n\t\tif (ErrorHandler.allItems && ErrorHandler.allItems.length > 0) {\r\n\t\t\tlet filtered: ErrorHandler[] = ErrorHandler.allItems.filter(handler => {\r\n\t\t\t\treturn handler.code === code && handler.type === type\r\n\t\t\t});\r\n\t\t\tif (filtered && filtered.length > 0) {\r\n\t\t\t\tresult = filtered[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\texecuteApi(error: BinanceError | HttpError): Promise<any> {\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\tif (this.port !== null && this.method !== null) {\r\n\t\t\t\tlet reqOpts: RequestInit = <RequestInit>{};\r\n\t\t\t\treqOpts.method = EMethod[this.method];\r\n\t\t\t\treqOpts.headers = new Headers();\r\n\r\n\t\t\t\tif (this.sendEmail && this.emailOptions) {\r\n\t\t\t\t\tErrorHandler.emailService = new NodeMailer(this.emailOptions);\r\n\t\t\t\t\tlet msgOptions: IMessageOptions = <IMessageOptions>{};\r\n\t\t\t\t\tmsgOptions.from = this.emailAddress;\r\n\t\t\t\t\tmsgOptions.to = this.emailAddress;\r\n\t\t\t\t\tlet message: string = (this.type === EErrorType.Binance) ? error['msg'] : error['message'];\r\n\t\t\t\t\tmsgOptions.subject = `A new ${EErrorType[this.type] || \"Unknown\"} error has been received | ${message}`;\r\n\t\t\t\t\tmsgOptions.text = `${new Date().toLocaleDateString()} : \\n Code: ${error.code} \\n Message: ${message}`;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tawait ErrorHandler.emailService.sendEmail(msgOptions);\r\n\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet fetch = await BotHttp.fetch(this.url, reqOpts);\r\n\t\t\t\t\tresolve(fetch);\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tconstructor(code: number, port: number, type: EErrorType, method: EMethod, sendEmail: boolean, timeout?: number, emailAddress?: string, emailOptions?: IServiceOptions, endpoint = \"http://localhost\") {\r\n\t\tthis.type = type;\r\n\t\tthis.code = code;\r\n\t\tthis.port = port || null;\r\n\t\tthis.method = method;\r\n\t\tthis.emailAddress = emailAddress || null;\r\n\t\tthis.sendEmail = sendEmail || false;\r\n\t\tthis.endpoint = endpoint;\r\n\t\tthis.timeout = timeout || 0;\r\n\t\tlet url: string = `${this.endpoint}:${this.port}`;\r\n\t\tlet props: any = {\"timeout\": this.timeout, \"restart\": this.restart, \"shutdown\": this.shutdown};\r\n\t\turl += BotHttp.makeQueryString(props);\r\n\t\tthis.url = url;\r\n\t}\r\n}\r\n"
  ]
}