{"version":3,"file":"HttpError.js","sourceRoot":"","sources":["../../src/Error/HttpError.ts"],"names":[],"mappings":"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","sourcesContent":["import {EErrorType} from \"./Email/Enums/EErrorType\";\r\nimport {BinanceError} from \"./BinanceError\";\r\nimport {EMethod} from \"../Rest/EMethod\";\r\nimport {BotHttp} from \"../Rest/BotHttp\";\r\nimport {NodeMailer} from \"./Email/NodeMailer\";\r\nimport {IServiceOptions} from \"./Email/Interfaces/IServiceOptions\";\r\nimport {IMessageOptions} from \"./Email/Interfaces/IMessageOptions\";\r\nimport {ServiceOptions} from \"./Email/ServiceOptions\";\r\nimport {BBLogger} from \"..\";\r\n\r\nexport class HttpErrorHandler {\r\n\tprivate static _emailService: NodeMailer;\r\n\tpublic static errorMsgRecipient: string;\r\n\tpublic static emailServiceOpts: ServiceOptions;\r\n\temailOptions?: IServiceOptions;\r\n\tendpoint?: string;\r\n\tmethod?: string;\r\n\tpayload?: any[];\r\n\tport?: number;\r\n\tsendEmail?: boolean;\r\n\tmsgOptions?: IMessageOptions;\r\n\ttype: string;\r\n\tmsgServiceOptions?: ServiceOptions;\r\n\r\n\tprivate readonly _url?: string;\r\n\r\n\tget url(): string {\r\n\t\treturn `${this.endpoint}:${this.port}`\r\n\t}\r\n\r\n\thandleError(code: number, message: string): Promise<any> {\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\r\n\t\t\t//posts message via REST\r\n\t\t\tif (this.port !== null && this.method !== null) {\r\n\t\t\t\tlet url: string = this._url;\r\n\t\t\t\tlet reqOpts: RequestInit = <RequestInit>{};\r\n\t\t\t\treqOpts.method = EMethod[this.method];\r\n\t\t\t\treqOpts.headers = new Headers();\r\n\r\n\t\t\t\tif (this.payload && this.payload.length > 0) {\r\n\t\t\t\t\turl = BotHttp.buildUrl(this._url, false, this.payload);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet fetch: any = {};\r\n\t\t\t\t\tfetch = await BotHttp.fetch(url, reqOpts);\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tBBLogger.error(err);\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//Send an email\r\n\t\t\tif (this.sendEmail && this.emailOptions && this.msgServiceOptions) {\r\n\t\t\t\tHttpErrorHandler._emailService = new NodeMailer();\r\n\t\t\t\tthis.msgOptions.subject = (!this.msgOptions.subject || this.msgOptions.subject.length === 0 )? `A new ${EErrorType[this.type] || \"Unknown\"} error has been received | ${message}`: this.msgOptions.subject;\r\n\t\t\t\tthis.msgOptions.text =(!this.msgOptions.text || this.msgOptions.text.length === 0 )?`${new Date().toLocaleDateString()} : \\n Code: ${code} \\n Message: ${message}`: this.msgOptions.text;\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tawait HttpErrorHandler._emailService.sendEmail(this.msgOptions, this.msgServiceOptions);\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tBBLogger.error(err);\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tresolve();\r\n\t\t});\r\n\t}\r\n\r\n\tconstructor(\r\n\t\ttype: EErrorType,\r\n\t\tmethod?: EMethod,\r\n\t\tport?: number,\r\n\t\tsendEmail?: boolean,\r\n\t\tendpoint?: string,\r\n\t\tmsgOptions?: IMessageOptions,\r\n\t\tmsgServiceOptions?: ServiceOptions\r\n\t) {\r\n\t\tlet msgOpts: IMessageOptions = <IMessageOptions>{};\r\n\t\tmsgOpts.to = HttpErrorHandler.errorMsgRecipient;\r\n\t\tthis.type = EErrorType[type];\r\n\t\tthis.method = EMethod[method];\r\n\t\tthis.port = port;\r\n\t\tthis.sendEmail = sendEmail || false;\r\n\t\tthis.endpoint = endpoint;\r\n\t\tthis.msgOptions = msgOptions || msgOpts;\r\n\t\tthis.msgServiceOptions = msgServiceOptions || HttpErrorHandler.emailServiceOpts;\r\n\r\n\t\tif (this.endpoint && this.port) {\r\n\t\t\tthis._url = `${this.endpoint}:${this.port}`;\r\n\t\t} else {\r\n\t\t\tthis._url = null;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class HttpError extends Error {\r\n\tpublic static allErrors: HttpError[] = [\r\n\t\tnew HttpError(-1000, \"UNKNOWN\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1001, \"DISCONNECTED\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1002, \"UNAUTHORIZED\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1003, \"TOO_MANY_REQUESTS\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1006, \"UNEXPECTED_RESP\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1007, \"TIMEOUT\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1013, \"INVALID_MESSAGE\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1014, \"UNKNOWN_ORDER_COMPOSITION\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1015, \"TOO_MANY_ORDERS\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1016, \"SERVICE_SHUTTING_DOWN\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1020, \"UNSUPPORTED_OPERATION\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1021, \"INVALID_TIMESTAMP\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1022, \"INVALID_SIGNATURE\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1100, \"ILLEGAL_CHARS\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1101, \"TOO_MANY_PARAMETERS\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1102, \"MANDATORY_PARAM_EMPTY_OR_MALFORMED\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1103, \"UNKNOWN_PARAM\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1104, \"UNREAD_PARAMETERS\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1105, \"PARAM_EMPTY\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1106, \"PARAM_NOT_REQUIRED\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-1130, \"INVALID_PARAMETER\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-2008, \"BAD_API_ID\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-2009, \"DUPLICATE_API_KEY_DESC\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-2010, \"INSUFFICIENT_BALANCE\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-2012, \"CANCEL_ALL_FAIL\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-2013, \"NO_SUCH_ORDER\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-2014, \"BAD_API_KEY_FMT\", new HttpErrorHandler(EErrorType.Binance)),\r\n\t\tnew HttpError(-2015, \"REJECTED_MBX_KEY\", new HttpErrorHandler(EErrorType.Binance))\r\n\t];\r\n\tcode: number;\r\n\thandler?: HttpErrorHandler;\r\n\tmessage: string;\r\n\r\n\tprivate static _getErrorByCode(code: number): HttpError {\r\n\t\tlet result: HttpError;\r\n\t\tif (HttpError.allErrors.length > 0) {\r\n\t\t\tlet filtered: HttpError[] = HttpError.allErrors.filter(handler => handler.code === code);\r\n\t\t\tif (filtered && filtered.length > 0) {\r\n\t\t\t\tresult = filtered[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprivate static _getErrorHandler(error: HttpError): HttpErrorHandler | null{\r\n\t\tlet match: HttpError[] = HttpError.allErrors.filter(err=>err.code===error.code);\r\n\t\tif(Array.isArray(match)&& typeof match[0].handler === \"object\"){\r\n\t\t\treturn match[0].handler;\r\n\t\t}else{\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static _getErrorParameters(err: BinanceError | HttpError): {code: number, message: string}{\r\n\t\tlet code: number = parseInt(err.code.toString());\r\n\t\tlet type: EErrorType = HttpError._getErrorType(err);\r\n\t\tlet message: string = (type === EErrorType.Binance) ? err['msg'] : err['message'];\r\n\t\treturn {code: code, message: message};\r\n\t}\r\n\r\n\tprivate static _getErrorType(err: BinanceError | HttpError): EErrorType {\r\n\t\t//parseInt(code.toString());\r\n\t\tlet code: number = parseInt(err.code.toString());\r\n\t\tlet isBinance: boolean = false;\r\n\t\tif (typeof err['msg'] === \"string\" && code < 0) {\r\n\t\t\tisBinance = true;\r\n\t\t} else if (typeof err['message'] === \"string\") {\r\n\t\t\tisBinance = false;\r\n\t\t}\r\n\t\treturn (isBinance) ? EErrorType.Binance : EErrorType.Node;\r\n\t}\r\n\r\n\tpublic static GetTimeoutFromIPBannedMsg(err: BinanceError): number {\r\n\t\tlet strFloat: string;\r\n\t\tlet result: number = 0;\r\n\t\tif (err && err.msg) {\r\n\t\t\tlet msg: string = \"IP banned until \";\r\n\t\t\tlet startIdx = err.msg.indexOf(msg) + msg.length;\r\n\t\t\tlet float = parseFloat(err.msg.slice(startIdx, startIdx + 13));\r\n\t\t\tstrFloat = float.toString();\r\n\t\t\tif (strFloat.length === 13) {\r\n\t\t\t\tresult = float - new Date().getTime();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tpublic static fromError(err: HttpError|BinanceError): HttpError{\r\n\t\tlet code: number = parseInt(err.code.toString());\r\n\t\tlet type: EErrorType = HttpError._getErrorType(err);\r\n\t\tlet message: string = (type === EErrorType.Binance) ? err['msg'] : err['message'];\r\n\t\tlet _httpError: HttpError = new HttpError(code, message);\r\n\t\tif(type === EErrorType.Binance && typeof err['handler']===\"object\"){\r\n\t\t\t_httpError.handler = err['handler'];\r\n\t\t}\r\n\t\treturn _httpError;\r\n\t}\r\n\r\n\tconstructor(code: number, message: string, handler?:HttpErrorHandler) {\r\n\t\tsuper();\r\n\t\tthis.code = code;\r\n\t\tthis.message = message;\r\n\t\tif (handler) {\r\n\t\t\tthis.handler = handler;\r\n\t\t} else {\r\n\t\t\tlet errHandler: HttpErrorHandler|null = HttpError._getErrorHandler(this);\r\n\t\t\tif(errHandler !== null){\r\n\t\t\t\tthis.handler = errHandler;\r\n\r\n\t\t\t\t//TODO remove ifee\r\n\t\t\t\t(async()=>{\r\n\t\t\t\t\tawait this.handler.handleError(code, message);\r\n\t\t\t\t})()\r\n\t\t\t}\r\n\t\t}\r\n\t\t}\r\n}\r\n"]}