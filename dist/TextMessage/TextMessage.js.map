{"version":3,"file":"TextMessage.js","sourceRoot":"","sources":["../../src/TextMessage/TextMessage.ts"],"names":[],"mappings":";;AACA,oDAA+C;AAC/C,gEAA2D;AAM3D;IA0DC,YAAY,WAAqB,EAAE,QAAsB;QACxD,IAAI,CAAC,UAAU,GAAoB,EAAE,CAAC;QACtC,EAAE,CAAA,CAAC,CAAC,QAAQ,IAAI,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA,CAAC;YAC7E,MAAM,IAAI,KAAK,CAAC,iFAAiF,CAAC,CAAC;QACpG,CAAC;QACD,IAAI,CAAC,UAAU,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC;QAC1C,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC;QAC5B,IAAI,CAAC,OAAO,GAAG,WAAW,CAAC;QAC3B,IAAI,cAAc,GAAe,WAAW,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE;YAClE,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,WAAW,CAAC,CAAC;QACjC,CAAC,CAAC,CAAC;QACH,EAAE,CAAC,CAAC,cAAc,IAAI,cAAc,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;YACjD,IAAI,KAAK,GAAa,cAAc,CAAC,CAAC,CAAC,CAAC;YACxC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;YAC3B,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC;QAC3B,CAAC;QAAC,IAAI,CAAC,CAAC;YACP,MAAM,IAAI,KAAK,CAAC,GAAG,WAAW,YAAY,CAAC,CAAC;QAC7C,CAAC;QACD,WAAW,CAAC,WAAW,GAAG,IAAI,uBAAU,EAAE,CAAC;IAC5C,CAAC;IApCO,uBAAuB,CAAC,WAAoB;QACnD,MAAM,CAAC,GAAG,WAAW,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;IACxC,CAAC;IAEM,KAAK,CAAC,IAAI,CAAC,OAAe,EAAE,OAAe,EAAE,cAAsB;QACzE,IAAI,SAAc,CAAC;QACnB,IAAI,CAAC;YACJ,IAAI,CAAC,UAAU,CAAC,EAAE,GAAG,IAAI,CAAC,uBAAuB,CAAC,cAAc,CAAC,CAAC;YAClE,IAAI,CAAC,UAAU,CAAC,OAAO,GAAG,OAAO,CAAC;YAClC,IAAI,CAAC,UAAU,CAAC,IAAI,GAAG,OAAO,CAAC;YAC/B,SAAS,GAAG,MAAM,mCAAgB,CAAC,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;YAC5F,MAAM,CAAC,SAAS,CAAC;QAClB,CAAC;QAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;YACd,MAAM,GAAG,CAAC;QACX,CAAC;IACF,CAAC;;AAvDa,sBAAU,GAAe;IACtC;QACC,MAAM,EAAE,KAAK;QACb,QAAQ,EAAE,aAAa;KACvB;IACD;QACC,MAAM,EAAE,SAAS;QACjB,QAAQ,EAAE,aAAa;KACvB;IACD;QACC,MAAM,EAAE,SAAS;QACjB,QAAQ,EAAE,WAAW;KACrB;IACD;QACC,MAAM,EAAE,SAAS;QACjB,QAAQ,EAAE,mBAAmB;KAC7B;IACD;QACC,MAAM,EAAE,YAAY;QACpB,QAAQ,EAAE,gBAAgB;KAC1B;IACD;QACC,MAAM,EAAE,cAAc;QACtB,QAAQ,EAAE,WAAW;KACrB;IACD;QACC,MAAM,EAAE,aAAa;QACrB,QAAQ,EAAE,mBAAmB;KAC7B;IACD;QACC,MAAM,EAAE,UAAU;QAClB,QAAQ,EAAE,gBAAgB;KAC1B;CACD,CAAC;AAlCH,kCA8EC","sourcesContent":["import {ICarrier} from \"./ICarrier\";\nimport {NodeMailer} from \"../Error/NodeMailer\";\nimport {HttpErrorHandler} from \"../Error/HttpErrorHandler\";\nimport {IMessageOptions} from \"../Error/Interfaces/IMessageOptions\";\nimport {ISmtpOptions} from \"../Error/Interfaces/ISmtpOptions\";\nimport {TCarrier} from \"./TCarrier\";\nimport {ECarrier} from \"../TextMessage/ECarrier\";\n\nexport class TextMessage {\n\tpublic static USCarriers: ICarrier[] = [\n\t\t{\n\t\t\t\"name\": \"att\",\n\t\t\t\"domain\": \"txt.att.net\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"tmobile\",\n\t\t\t\"domain\": \"tmomail.net\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"verizon\",\n\t\t\t\"domain\": \"vtext.com\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"cricket\",\n\t\t\t\"domain\": \"sms.mycricket.com\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"uscellular\",\n\t\t\t\"domain\": \"email.uscc.net\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"virginmobile\",\n\t\t\t\"domain\": \"vmobl.com\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"boostmobile\",\n\t\t\t\"domain\": \"myboostmobile.com\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"metropcs\",\n\t\t\t\"domain\": \"mymetropcs.com\"\n\t\t}\n\t];\n\tcarrier: TCarrier;\n\tdomain: string;\n\tpublic static mailService: NodeMailer;\n\tmsgOptions: IMessageOptions;\n\tsmtpOptions: ISmtpOptions;\n\n\tprivate _getCarrierEmailAddress(phoneNumber?: number): string {\n\t\treturn `${phoneNumber}@${this.domain}`;\n\t}\n\n\tpublic async send(subject: string, message: string, recipientPhone: number): Promise<void> {\n\t\tlet sentEmail: any;\n\t\ttry {\n\t\t\tthis.msgOptions.to = this._getCarrierEmailAddress(recipientPhone);\n\t\t\tthis.msgOptions.subject = message;\n\t\t\tthis.msgOptions.text = message;\n\t\t\tsentEmail = await HttpErrorHandler.mailService.sendEmail(this.msgOptions, this.smtpOptions);\n\t\t\treturn sentEmail;\n\t\t} catch (err) {\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\tconstructor(carrierName: ECarrier, smtpOpts: ISmtpOptions) {\n\t\tthis.msgOptions = <IMessageOptions>{};\n\t\tif(!smtpOpts || !smtpOpts.auth || !smtpOpts.auth.user || !smtpOpts.auth.pass){\n\t\t\tthrow new Error(\"Creating a new TextMessage requires email options with a username and password.\");\n\t\t}\n\t\tthis.msgOptions.from = smtpOpts.auth.user;\n\t\tthis.smtpOptions = smtpOpts;\n\t\tthis.carrier = carrierName;\n\t\tlet matchedCarrier: ICarrier[] = TextMessage.USCarriers.filter(d => {\n\t\t\treturn (d.name === carrierName);\n\t\t});\n\t\tif (matchedCarrier && matchedCarrier.length > 0) {\n\t\t\tlet match: ICarrier = matchedCarrier[0];\n\t\t\tthis.domain = match.domain;\n\t\t\tthis.carrier = match.name;\n\t\t} else {\n\t\t\tthrow new Error(`${carrierName} not found`);\n\t\t}\n\t\tTextMessage.mailService = new NodeMailer();\n\t}\n}"]}