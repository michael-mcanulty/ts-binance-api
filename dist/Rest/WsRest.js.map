{
  "version": 3,
  "file": "WsRest.js",
  "sourceRoot": "",
  "sources": [
    "../../src/Rest/WsRest.ts"
  ],
  "names": [],
  "mappings": ";;;;;;;;;;AAAA,0CAAyC;AACzC,iCAAgC;AAGhC,kDAA6C;AAK7C,uCAAkC;AAIlC;IA8HC,YAAY,OAAY;QA3HjB,SAAI,GAAU,yBAAyB,CAAC;QA4H9C,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;IACxB,CAAC;IA5HO,WAAW,CAAC,IAAY,EAAE,OAAe,EAAE,QAAe;QACjE,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;YACd,MAAM,IAAI,KAAK,CAAC,oCAAoC,CAAC,CAAA;QACtD,CAAC;QAED,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;YACpB,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACtC,MAAM,IAAI,KAAK,CAAC,UAAU,IAAI,aAAa,CAAC,aAAa,CAAC,CAAA;YAC3D,CAAC;QACF,CAAC,CAAC,CAAC;QAEH,MAAM,CAAC,IAAI,CAAA;IACZ,CAAC;IACO,eAAe,CAAC,MAAU;QACjC,IAAI,MAAa,CAAC;QAClB,EAAE,CAAA,CAAC,CAAC,MAAM,CAAC,CAAA,CAAC;YACX,MAAM,GAAG,EAAE,CAAC;QACb,CAAC;QAAA,IAAI,CAAA,CAAC;YACL,MAAM,GAAG,GAAG,kBAAkB,CAAC;YAC/B,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC,IAAI,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACjF,CAAC;QACD,MAAM,CAAC,MAAM,CAAC;IACf,CAAC;IACO,QAAQ,CAAC,IAAW,EAAE,IAAW,EAAE,SAAiB,KAAK;QAChE,MAAM,CAAC,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,GAAG,IAAI,GAAG,MAAM,CAAC,CAAC,CAAC,EAAE,CAAA,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,EAAE,CAAC;IAC/G,CAAC;IAEM,KAAK,CAAC,IAAW,EAAE,OAAW,EAAE,WAAsB;QAC5D,MAAM,CAAC,IAAI,OAAO,CAAC,CAAO,OAAO,EAAE,MAAM,EAAC,EAAE;YAC3C,IAAI,IAAQ,CAAC;YACb,IAAI,GAAU,CAAC;YACf,IAAI,GAAa,CAAC;YAClB,IAAI,MAAM,GAAU,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,OAAO,EAAE,WAAW,CAAC,MAAM,CAAC,CAAC;YACrE,IAAI,OAAO,GAA6B,EAAE,CAAC;YAC3C,OAAO,CAAC,MAAM,GAAG,iBAAO,CAAC,iBAAO,CAAC,GAAG,CAAC,CAAC;YACtC,OAAO,CAAC,OAAO,GAAG,EAAE,CAAC;YACrB,IAAI,GAAG,GAAY,MAAM,KAAK,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;YAChD,IAAI,GAAG,MAAM,GAAG,CAAC,IAAI,EAAE,CAAC;YACxB,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;gBACb,GAAG,GAAG,IAAI,CAAC,GAAG,IAAI,GAAG,GAAG,CAAC,MAAM,IAAI,GAAG,CAAC,UAAU,EAAE,CAAC;gBACpD,GAAG,GAAG,IAAI,qBAAS,CAAC,GAAG,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;gBACpC,MAAM,CAAC,GAAG,CAAC,CAAC;YACb,CAAC;YAAA,IAAI,CAAA,CAAC;gBACL,OAAO,CAAC,IAAI,CAAC,CAAC;YACf,CAAC;QACF,CAAC,CAAA,CAAC,CAAA;IACH,CAAC;IAED,IAAI;QACH,MAAM,CAAC,IAAI,OAAO,CAAC,CAAO,OAAO,EAAE,MAAM,EAAE,EAAE;YAC5C,IAAG,CAAC;gBACH,IAAI,OAAO,GAAW,MAAM,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;gBACxD,OAAO,CAAC,OAAO,CAAC,CAAC;YAClB,CAAC;YAAA,KAAK,CAAA,CAAC,GAAG,CAAC,CAAA,CAAC;gBACX,MAAM,CAAC,uCAAuC,GAAG,EAAE,CAAC,CAAC;YACtD,CAAC;QACF,CAAC,CAAA,CAAC,CAAC;IACJ,CAAC;IACD,IAAI;QACH,MAAM,CAAC,IAAI,OAAO,CAAC,CAAO,OAAO,EAAE,MAAM,EAAE,EAAE;YAE5C,IAAG,CAAC;gBACH,IAAI,IAAW,CAAC;gBAChB,IAAI,MAAM,GAAc,MAAM,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;gBAC1D,IAAI,GAAG,MAAM,CAAC,UAAU,CAAC;gBACzB,OAAO,CAAC,IAAI,CAAC,CAAC;YACf,CAAC;YAAA,KAAK,CAAA,CAAC,GAAG,CAAC,CAAA,CAAC;gBACX,MAAM,CAAC,uCAAuC,GAAG,EAAE,CAAC,CAAC;YACtD,CAAC;QACF,CAAC,CAAA,CAAC,CAAC;IACJ,CAAC;IACD,UAAU,CAAC,IAAW,EAAE,IAAU,EAAE,WAAuB;QAC1D,MAAM,CAAC,IAAI,OAAO,CAAC,CAAO,OAAO,EAAE,MAAM,EAAE,EAAE;YAC5C,IAAI,MAAU,CAAC;YACd,IAAG,CAAC;gBACJ,MAAM,GAAG,MAAM,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,EAAE,WAAW,CAAC,CAAC;gBACnD,OAAO,CAAC,MAAM,CAAC,CAAC;YACjB,CAAC;YAAA,KAAK,CAAA,CAAC,GAAG,CAAC,CAAA,CAAC;gBACV,MAAM,CAAC,GAAG,CAAC,CAAC;YACd,CAAC;QACF,CAAC,CAAA,CAAC,CAAC;IACJ,CAAC;IAEM,WAAW,CAAC,IAAW,EAAE,IAAS,EAAE,WAAsB;QAChE,MAAM,CAAC,IAAI,OAAO,CAAC,CAAO,OAAO,EAAE,MAAM,EAAE,EAAE;YAC5C,IAAI,MAAW,CAAC;YAChB,IAAI,SAAgB,CAAC;YACrB,IAAI,SAAqB,CAAC;YAC1B,IAAI,OAAY,CAAC;YACjB,IAAI,WAAW,GAAe,EAAC,cAAc,EAAE,IAAI,CAAC,OAAO,CAAC,GAAG,EAAC,CAAC;YACjE,IAAI,OAAO,GAAW,IAAI,OAAO,CAAC,WAAW,CAAC,CAAC;YAC/C,IAAI,SAAS,GAAU,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;YACjD,WAAW,CAAC,OAAO,GAAG,OAAO,CAAC;YAC9B,WAAW,CAAC,MAAM,GAAG,iBAAO,CAAC,GAAG,CAAC;YACjC,WAAW,CAAC,IAAI,GAAG,IAAI,CAAC;YAExB,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;gBAC/C,MAAM,IAAI,KAAK,CAAC,qEAAqE,CAAC,CAAC;YACxF,CAAC;YAED,IAAI,CAAC;gBACJ,EAAE,CAAC,CAAC,IAAI,IAAI,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,CAAC;oBACxC,SAAS,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;gBAC/C,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,SAAS,CAAC,UAAU,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;gBACnC,CAAC;gBAED,SAAS,GAAG,MAAM,CAAC,UAAU,CAAC,QAAQ,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,eAAe,mBACpF,IAAI,IACP,SAAS,IACR,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;gBAC5B,OAAO,GAAG,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,mBAAK,IAAI,IAAE,SAAS,EAAE,SAAS,GAAC,CAAC;gBAEvE,MAAM,GAAG,MAAM,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE,OAAO,EAAE,WAAW,CAAC,CAAC;gBAC3D,OAAO,CAAC,MAAM,CAAC,CAAC;YACjB,CAAC;YAAA,KAAK,CAAA,CAAC,GAAG,CAAC,CAAA,CAAC;gBACX,MAAM,CAAC,GAAG,CAAC,CAAC;YACb,CAAC;QACF,CAAC,CAAA,CAAC,CAAC;IACJ,CAAC;CAMD;AAjID,wBAiIC",
  "sourcesContent": [
    "import * as fetch from 'isomorphic-fetch'\nimport * as crypto from 'crypto'\nimport zip = require('lodash.zipobject');\nimport * as path from \"path\";\nimport {HttpError} from \"../Error/HttpError\";\nimport {Api} from \"../Account/Api\";\nimport {iBinanceRestOpts} from \"./Interfaces/iRestOptions\";\nimport {iBinanceOptions} from \"@michael-mcanulty/bb-models\";\nimport {ServerTime} from \"./Interfaces/ServerTime\";\nimport {eMethod} from \"./eMethod\";\nimport {iCallOpts} from \"./Interfaces/iCallOpts\";\nimport {publicDecrypt} from \"crypto\";\n\nexport class WsRest{\n\tpublic apiAuth: Api;\n\tpublic options:iBinanceOptions;\n\tpublic base:string = 'https://api.binance.com';\n\tprivate checkParams(name: string, payload: object, requires: any[]): boolean {\n\t\tif (!payload) {\n\t\t\tthrow new Error('You need to pass a payload object.')\n\t\t}\n\n\t\trequires.forEach(r => {\n\t\t\tif (!payload[r] && isNaN(payload[r])) {\n\t\t\t\tthrow new Error(`Method ${name} requires ${r} parameter.`)\n\t\t\t}\n\t\t});\n\n\t\treturn true\n\t}\n\tprivate makeQueryString(params:any):string{\n\t\tlet result:string;\n\t\tif(!params){\n\t\t\tresult = \"\";\n\t\t}else{\n\t\t\tconst esc = encodeURIComponent;\n\t\t\tresult = Object.keys(params).map(k => `?${esc(k)}=${esc(params[k])}`).join('&');\n\t\t}\n\t\treturn result;\n\t}\n\tprivate buildUrl(path:string, data:object, noData:boolean = false):string{\n\t\treturn `${this.base}${path.includes('/wapi') ? '' : '/api'}${path}${noData ? '': this.makeQueryString(data)}`;\n\t}\n\n\tpublic fetch(path:string, payload:any, callOptions: iCallOpts):Promise<any>{\n\t\treturn new Promise(async (resolve, reject)=>{\n\t\t\tlet json:any;\n\t\t\tlet msg:string;\n\t\t\tlet err:HttpError;\n\t\t\tlet params:string = this.buildUrl(path, payload, callOptions.noData);\n\t\t\tlet reqOpts: RequestInit = <RequestInit>{};\n\t\t\treqOpts.method = eMethod[eMethod.GET];\n\t\t\treqOpts.headers = {};\n\t\t\tlet res:Response = await fetch(params, reqOpts);\n\t\t\tjson = await res.json();\n\t\t\tif (!res.ok) {\n\t\t\t\tmsg = json.msg || `${res.status} ${res.statusText}`;\n\t\t\t\terr = new HttpError(msg, json.code);\n\t\t\t\treject(err);\n\t\t\t}else{\n\t\t\t\tresolve(json);\n\t\t\t}\n\t\t})\n\t}\n\n\ttime():Promise<boolean>{\n\t\treturn new Promise(async (resolve, reject) => {\n\t\t\ttry{\n\t\t\t\tlet pingRes:boolean = await this.publicCall('/v1/ping');\n\t\t\t\tresolve(pingRes);\n\t\t\t}catch(err){\n\t\t\t\treject(`Error in server time sync. Message: ${err}`);\n\t\t\t}\n\t\t});\n\t}\n\tping():Promise<number>{\n\t\treturn new Promise(async (resolve, reject) => {\n\n\t\t\ttry{\n\t\t\t\tlet time:number;\n\t\t\t\tlet server:ServerTime = await this.publicCall('/v1/time');\n\t\t\t\ttime = server.serverTime;\n\t\t\t\tresolve(time);\n\t\t\t}catch(err){\n\t\t\t\treject(`Error in server time sync. Message: ${err}`);\n\t\t\t}\n\t\t});\n\t}\n\tpublicCall(path:string, data?: any, callOptions?: iCallOpts):Promise<any>{\n\t\treturn new Promise(async (resolve, reject) => {\n\t\t\tlet result:any;\n\t\t  try{\n\t\t\t\tresult = await this.fetch(path, data, callOptions);\n\t\t\t\tresolve(result);\n\t\t\t}catch(err){\n\t\t  \treject(err);\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic privateCall(path:string, data: any, callOptions: iCallOpts):Promise<any> {\n\t\treturn new Promise(async (resolve, reject) => {\n\t\t\tlet result: any;\n\t\t\tlet signature:string;\n\t\t\tlet timestamp: ServerTime;\n\t\t\tlet newData: any;\n\t\t\tlet headersInit:HeadersInit = {'X-MBX-APIKEY': this.apiAuth.key};\n\t\t\tlet headers:Headers = new Headers(headersInit);\n\t\t\tlet fetchPath:string = this.buildUrl(path, data);\n\t\t\tcallOptions.headers = headers;\n\t\t\tcallOptions.method = eMethod.GET;\n\t\t\tcallOptions.json = true;\n\n\t\t\tif (!this.apiAuth.key || !this.apiAuth.secret) {\n\t\t\t\tthrow new Error('You need to pass an API key and secret to make authenticated calls.');\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tif (data && this.options.useServerTime) {\n\t\t\t\t\ttimestamp = await this.publicCall('/v1/time');\n\t\t\t\t} else {\n\t\t\t\t\ttimestamp.serverTime = Date.now();\n\t\t\t\t}\n\n\t\t\t\tsignature = crypto.createHmac('sha256', this.apiAuth.secret).update(this.makeQueryString({\n\t\t\t\t\t...data,\n\t\t\t\t\ttimestamp\n\t\t\t\t}).substr(1)).digest('hex');\n\t\t\t\tnewData = callOptions.noExtra ? data : {...data, timestamp, signature};\n\n\t\t\t\tresult = await this.fetch(fetchPath, newData, callOptions);\n\t\t\t\tresolve(result);\n\t\t\t}catch(err){\n\t\t\t\treject(err);\n\t\t\t}\n\t\t});\n\t}\n\n\n\tconstructor(spiAuth: Api){\n\t\tthis.apiAuth = spiAuth;\n\t}\n}\n"
  ]
}