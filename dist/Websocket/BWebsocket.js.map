{
  "version": 3,
  "file": "BWebsocket.js",
  "sourceRoot": "",
  "sources": [
    "../../src/Websocket/BWebsocket.ts"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "import * as Html5WebSocket from 'html5-websocket'\r\nimport {default as ReconnectingWebSocket, iReconWSOptions} from \"./ReconnectingWebSocket/ReconnectingWebSocket\";\r\nimport {IStreamTickerRaw} from \"../ExchangeInfo/Interfaces/IStreamTickerRaw\";\r\nimport {Price} from \"../Transaction/Price\";\r\nimport {Ticker} from \"../ExchangeInfo/ticker\";\r\nimport {iBinanceOptions} from \"../Binance/Interfaces/iBinanceOptions\";\r\nimport {Rest} from \"../Rest/Rest\";\r\nimport {HttpError} from \"../Error/HttpError\";\r\nimport {IStreamRawKlineResponse} from \"../ExchangeInfo/Interfaces/ICandleBinance\";\r\nimport {Candle} from \"../ExchangeInfo/Candle\";\r\n\r\nexport class BWebsocket extends Rest {\r\n\tprivate static _INSTANCE: BWebsocket;\r\n\tprivate readonly _reconOptions: iReconWSOptions = <iReconWSOptions>{};\r\n\tprivate static _ws: ReconnectingWebSocket;\r\n\tpublic base: string = 'wss://stream.binance.com:9443/ws';\r\n\tprivate static isAlive: boolean = false;\r\n\tpublic options: iBinanceOptions;\r\n\tprivate _url: string;\r\n\r\n\tget url(): string {\r\n\t\treturn this._url;\r\n\t}\r\n\r\n\tset url(value: string) {\r\n\t\tthis._url = value;\r\n\t}\r\n\r\n\tprivate _getTickerUrl(symbol?: string | null): string {\r\n\t\tif (symbol && symbol !== null) {\r\n\t\t\treturn `${this.base}/${symbol.toLowerCase()}@ticker`;\r\n\t\t} else {\r\n\t\t\treturn `${this.base}/!ticker@arr`;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic static get Instance() {\r\n\t\treturn this._INSTANCE;\r\n\t}\r\n\r\n\tprivate _getTickers(cb: Function): any {\r\n\t\tlet tickers: Ticker[];\r\n\t\tlet w: ReconnectingWebSocket = this.openWebSocket(this._getTickerUrl(null));\r\n\t\tw.onmessage = msg => {\r\n\t\t\tlet res: IStreamTickerRaw[];\r\n\t\t\tres = JSON.parse(msg.data);\r\n\t\t\ttickers = res.map((raw: IStreamTickerRaw) => {\r\n\t\t\t\treturn new Ticker(raw);\r\n\t\t\t});\r\n\t\t\tcb(tickers);\r\n\t\t};\r\n\r\n\t\treturn (options) => w.close(1000, 'Close handle was called');\r\n\t}\r\n\r\n\tpublic candles(symbols:string[], intervals:string[], cb:Function):any{\r\n\t\tconst symbolCache = symbols.map(symbol=>{\r\n\t  \treturn intervals.map(interval=>{\r\n\t\t\t\tlet w: ReconnectingWebSocket = this.openWebSocket(`${this.base}/${symbol.toLowerCase()}@kline_${interval}`);\r\n\t\t\t\tw.onmessage = msg => {\r\n\t\t\t\t\tlet klineRes: IStreamRawKlineResponse;\r\n\t\t\t\t\tklineRes = JSON.parse(msg.data);\r\n\t\t\t\t\tlet candle:Candle;\r\n\t\t\t\t\tif(klineRes.k.x){\r\n\t\t\t\t\t\tcandle = Candle.fromStream(klineRes);\r\n\t\t\t\t\t\tcb(candle);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\treturn w;\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treturn (options) => symbolCache.forEach(cache => cache.forEach(w=>w.close(1000, 'Close handle was called')));\r\n\t};\r\n\r\n\tpublic getUser(): Promise<any> {\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\tconst keepStreamAlive = (method, listenKey) => () => method({listenKey});\r\n\t\t\tthis.user = async cb => {\r\n\t\t\t\tRest.listenKey = await this.getDataStream();\r\n\t\t\t\tconst w = this.openWebSocket(`${this.base}/${Rest.listenKey}`);\r\n\t\t\t\tw.onmessage = (msg) => (this.userEventHandler(cb)(msg));\r\n\r\n\t\t\t\tconst int = setInterval(keepStreamAlive(this.keepDataStream, Rest.listenKey), 50e3);\r\n\t\t\t\tkeepStreamAlive(this.keepDataStream, Rest.listenKey)();\r\n\r\n\t\t\t\tlet result = async () => {\r\n\t\t\t\t\tclearInterval(int);\r\n\t\t\t\t\tawait this.closeDataStream();\r\n\t\t\t\t\tw.close(1000, 'Close handle was called');\r\n\t\t\t\t};\r\n\t\t\t\tresolve(result);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t//Check for disconnected state\r\n\tprivate static heartbeat(): void {\r\n\t\tsetInterval(async () => {\r\n\t\t\ttry {\r\n\t\t\t\tthis.isAlive = await BWebsocket.Instance.ping();\r\n\t\t\t} catch (err) {\r\n\t\t\t\tlet error: HttpError = new HttpError({msg: 'DISCONNECTED', code: -1001});\r\n\t\t\t\tBWebsocket._ws.close(error.code, error.message);\r\n\t\t\t}\r\n\t\t}, 3000);\r\n\t}\r\n\r\n\tpublic openWebSocket(url): ReconnectingWebSocket {\r\n\t\tif (url) {\r\n\t\t\tthis.url = url;\r\n\t\t\tBWebsocket._ws = new ReconnectingWebSocket(this.url, undefined, this._reconOptions);\r\n\t\t\treturn BWebsocket._ws;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic prices(cb: Function) {\r\n\t\tlet ticksToPrices = (tickers: Ticker[]) => {\r\n\t\t\tlet prices: Price[] = tickers.map(t => {\r\n\t\t\t\treturn t.toPrice();\r\n\t\t\t});\r\n\t\t\tcb(prices);\r\n\t\t};\r\n\r\n\t\tthis._getTickers(ticksToPrices);\r\n\t}\r\n\r\n\tconstructor(options?: iBinanceOptions) {\r\n\t\tsuper(options);\r\n\t\tthis.options = options;\r\n\t\tthis._reconOptions = <iReconWSOptions>{};\r\n\t\tthis._reconOptions.connectionTimeout = 4E3;\r\n\t\tthis._reconOptions.constructor = typeof window !== 'undefined' ? BWebsocket : Html5WebSocket;\r\n\t\tthis._reconOptions.debug = false;\r\n\t\tthis._reconOptions.maxReconnectionDelay = 10E3;\r\n\t\tthis._reconOptions.maxRetries = Infinity;\r\n\t\tthis._reconOptions.minReconnectionDelay = 4E3;\r\n\t}\r\n}"
  ]
}