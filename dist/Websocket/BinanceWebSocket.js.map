{"version":3,"file":"BinanceWebSocket.js","sourceRoot":"","sources":["../../src/Websocket/BinanceWebSocket.ts"],"names":[],"mappings":"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","sourcesContent":["\r\nimport * as Html5WebSocket from 'html5-websocket'\r\nimport {iOptions, default as ReconnectingWebSocket} from \"./ReconnectingWebSocket/ReconnectingWebSocket\";\r\nimport * as httpMethods from 'http'\r\nimport {iTicker} from \"@michael-mcanulty/bb-models\";\r\n\r\nexport class BinanceWebSocket {\r\n\tpublic cache:any;\r\n\tpublic base:string = 'https://api.binance.com';\r\n\tprivate readonly _options: iOptions = <iOptions>{};\r\n\tprivate _reconWebSocket: ReconnectingWebSocket;\r\n\tprivate _url: string;\r\n\tprivate tickerUrl(symbol):string{\r\n\t\treturn `${this.base}/${symbol.toLowerCase()}@ticker`;\r\n\t}\r\n\tget url(): string {\r\n\t\treturn this._url;\r\n\t}\r\n\tset url(value: string) {\r\n\t\tthis._url = value;\r\n\t}\r\n\r\n\tpublic getTicker(payload, cb){\r\n\t\tlet tickerTransform = m=> (<iTicker>{\r\n\t\t\teventType: m.e,\r\n\t\t\teventTime: m.E,\r\n\t\t\tsymbol: m.s,\r\n\t\t\tpriceChange: m.p,\r\n\t\t\tpriceChangePercent: m.P,\r\n\t\t\tweightedAvg: m.w,\r\n\t\t\tprevDayClose: m.x,\r\n\t\t\tcurDayClose: m.c,\r\n\t\t\tcloseTradeQuantity: m.Q,\r\n\t\t\tbestBid: m.b,\r\n\t\t\tbestBidQnt: m.B,\r\n\t\t\tbestAsk: m.a,\r\n\t\t\tbestAskQnt: m.A,\r\n\t\t\topen: m.o,\r\n\t\t\thigh: m.h,\r\n\t\t\tlow: m.l,\r\n\t\t\tvolume: m.v,\r\n\t\t\tvolumeQuote: m.q,\r\n\t\t\topenTime: m.O,\r\n\t\t\tcloseTime: m.C,\r\n\t\t\tfirstTradeId: m.F,\r\n\t\t\tlastTradeId: m.L,\r\n\t\t\ttotalTrades: m.n,\r\n\t\t});\r\n\r\n\t\tthis.cache = (Array.isArray(payload) ? payload : [payload]).map(symbol => {\r\n\t\t\tconst w:ReconnectingWebSocket = this.openWebSocket(this.tickerUrl(symbol));\r\n\r\n\t\t\tw.onmessage = msg => {\r\n\t\t\t\tcb(tickerTransform(JSON.parse(msg.data)))\r\n\t\t\t}\r\n\r\n\t\t\treturn w\r\n\t\t});\r\n\r\n\t\treturn (options) => this.cache.forEach(w => w.close(1000, 'Close handle was called', { keepClosed: true, ...options }))\r\n\t}\r\n\tpublic openWebSocket(url): ReconnectingWebSocket {\r\n\t\tif (url) {\r\n\t\t\tthis.url = url;\r\n\t\t\tthis._reconWebSocket = new ReconnectingWebSocket(this.url, undefined, this._options);\r\n\t\t\treturn this._reconWebSocket;\r\n\t\t}\r\n\t}\r\n\r\n\tconstructor() {\r\n\t\tthis._options = <iOptions>{};\r\n\t\tthis._options.connectionTimeout = 4E3;\r\n\t\tthis._options.constructor = typeof window !== 'undefined' ? BinanceWebSocket : Html5WebSocket;\r\n\t\tthis._options.debug = false;\r\n\t\tthis._options.maxReconnectionDelay = 10E3;\r\n\t\tthis._options.maxRetries = Infinity;\r\n\t\tthis._options.minReconnectionDelay = 4E3;\r\n\t\tthis._reconWebSocket = new ReconnectingWebSocket(this.url, undefined, this._options);\r\n\t}\r\n}"]}