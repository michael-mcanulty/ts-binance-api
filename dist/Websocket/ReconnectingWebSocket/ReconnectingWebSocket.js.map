{"version":3,"file":"ReconnectingWebSocket.js","sourceRoot":"","sources":["../../../src/Websocket/ReconnectingWebSocket/ReconnectingWebSocket.ts"],"names":[],"mappings":";AAAA;;;;;GAKG;;AAEH,gCAAgC;AAEhC,qCAA0E;AA0B1E;IAyYC,YAAY,GAAgB,EAAE,UAAyB,EAAE,EAAE,SAA6B;QAxYhF,iBAAY,GAAG,KAAK,CAAC;QAErB,eAAU,GAAiB;YAClC,KAAK,EAAE,EAAE;YACT,OAAO,EAAE,EAAE;YACX,IAAI,EAAE,EAAE;YACR,KAAK,EAAE,EAAE;SACT,CAAC;QAGM,qBAAgB,GAAG,IAAI,CAAC;QAIf,mBAAc,GAAG,IAAI,GAAG,CAA+B;YACvE,CAAC,MAAM,EAAE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACrC,CAAC,OAAO,EAAE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACvC,CAAC,OAAO,EAAE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACvC,CAAC,SAAS,EAAE,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SAC3C,CAAC,CAAC;QAII,YAAO,GAAiC,SAAS,CAAC;QAIlD,YAAO,GAA4B,SAAS,CAAC;QAI7C,cAAS,GAAmC,SAAS,CAAC;QAKtD,WAAM,GAA4B,SAAS,CAAC;QAkC3C,gBAAW,GAAG,MAAM,CAAC;QAcrB,gBAAW,GAAG,CAAC,CAAC,CAAC;QAqTxB,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC;QAChB,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;QAC5B,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;QACxB,IAAI,CAAC,QAAQ,EAAE,CAAC;QAEhB,EAAE,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;YACvC,IAAI,CAAC,QAAQ,GAAkB;gBAC9B,oBAAoB,EAAE,KAAK;gBAC3B,oBAAoB,EAAE,IAAI,GAAG,IAAI,CAAC,MAAM,EAAE,GAAG,IAAI;gBACjD,SAAS,EAAE,IAAI;gBACf,2BAA2B,EAAE,GAAG;gBAChC,iBAAiB,EAAE,IAAI;gBACvB,UAAU,EAAE,QAAQ;gBACpB,KAAK,EAAE,KAAK;aACZ,CAAC;QACH,CAAC;QAAC,IAAI,CAAC,CAAC;YACP,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;QACzB,CAAC;IACF,CAAC;IArXD,MAAM,KAAK,MAAM;QAChB,MAAM,CAAC,CAAC,CAAC;IACV,CAAC;IAED,IAAI,MAAM;QACT,MAAM,CAAC,qBAAqB,CAAC,MAAM,CAAC;IACrC,CAAC;IAED,MAAM,KAAK,OAAO;QACjB,MAAM,CAAC,CAAC,CAAC;IACV,CAAC;IAED,IAAI,OAAO;QACV,MAAM,CAAC,qBAAqB,CAAC,OAAO,CAAC;IACtC,CAAC;IAED,MAAM,KAAK,UAAU;QACpB,MAAM,CAAC,CAAC,CAAC;IACV,CAAC;IAED,IAAI,UAAU;QACb,MAAM,CAAC,qBAAqB,CAAC,UAAU,CAAC;IACzC,CAAC;IAED,MAAM,KAAK,IAAI;QACd,MAAM,CAAC,CAAC,CAAC;IACV,CAAC;IAED,IAAI,IAAI;QACP,MAAM,CAAC,qBAAqB,CAAC,IAAI,CAAC;IACnC,CAAC;IAID,IAAI,UAAU;QACb,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;IAC1D,CAAC;IAED,IAAI,UAAU,CAAC,KAAa;QAC3B,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;QACzB,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YAEd,IAAI,CAAC,GAAG,CAAC,UAAU,GAAG,KAAK,CAAC;QAC7B,CAAC;IACF,CAAC;IAOD,IAAI,UAAU;QACb,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;IACtC,CAAC;IAQD,IAAI,cAAc;QACjB,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC;IAC/C,CAAC;IAMD,IAAI,UAAU;QACb,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE,CAAC;IAC5C,CAAC;IAOD,IAAI,QAAQ;QACX,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC;IAC1C,CAAC;IAKD,IAAI,UAAU;QACb,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,qBAAqB,CAAC,UAAU,CAAC;IAC1E,CAAC;IAKD,IAAI,GAAG;QACN,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC;IACrC,CAAC;IAEO,WAAW;QAClB,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;IACtB,CAAC;IAKO,aAAa;QACpB,IAAI,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;QAC5B,GAAG,CAAC,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,CAAC,IAAI,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC;YACnD,IAAI,CAAC,GAAI,CAAC,gBAAgB,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;QAC3C,CAAC;IACF,CAAC;IAEO,QAAQ;QACf,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;YACvB,MAAM,CAAC;QACR,CAAC;QACD,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QAEzB,MAAM,EACL,UAAU,GAAG,IAAI,CAAC,QAAQ,CAAC,UAAU,EACrC,iBAAiB,GAAG,IAAI,CAAC,QAAQ,CAAC,iBAAiB,EACnD,SAAS,GAAG,qBAAqB,CAAC,kBAAkB,EAAE,GACtD,GAAG,IAAI,CAAC,QAAQ,CAAC;QAElB,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,IAAI,UAAU,CAAC,CAAC,CAAC;YACpC,IAAI,CAAC,MAAM,CAAC,qBAAqB,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,EAAE,UAAU,CAAC,CAAC;YACvE,MAAM,CAAC;QACR,CAAC;QAED,IAAI,CAAC,WAAW,EAAE,CAAC;QAEnB,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;QACzC,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACxB,EAAE,CAAC,CAAC,CAAC,qBAAqB,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YACnD,MAAM,KAAK,CAAC,uCAAuC,CAAC,CAAC;QACtD,CAAC;QACD,IAAI,CAAC,KAAK,EAAE;aACV,IAAI,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aACvC,IAAI,CAAC,GAAG,CAAC,EAAE;YACX,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,EAAC,GAAG,EAAE,SAAS,EAAE,IAAI,CAAC,UAAU,EAAC,CAAC,CAAC;YAC1D,IAAI,CAAC,GAAG,GAAG,IAAI,SAAS,CAAC,GAAG,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;YAE/C,IAAI,CAAC,GAAI,CAAC,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC;YACxC,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;YAC1B,IAAI,CAAC,aAAa,EAAE,CAAC;YACrB,IAAI,CAAC,eAAe,GAAG,UAAU,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,EAAE,EAAE,iBAAiB,CAAC,CAAC;QACnF,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,MAAM,CAAC,GAAG,MAAa;QAC9B,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;YAEzB,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,MAAM,CAAC,CAAC;QAChC,CAAC;IACF,CAAC;IAEO,WAAW,CAAC,IAAa,EAAE,MAAe;QACjD,YAAY,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QACnC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YACf,MAAM,CAAC;QACR,CAAC;QACD,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACxB,IAAI,CAAC;YACJ,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;YAC7B,IAAI,CAAC,YAAY,CAAC,IAAI,mBAAU,CAAC,IAAI,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC;QACvD,CAAC;QAAC,KAAK,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;QAEjB,CAAC;IACF,CAAC;IAEO,aAAa;QACpB,IAAI,KAAK,GAAG,CAAC,CAAC;QACd,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC,CAAC;YAC1B,MAAM,EACL,2BAA2B,GAAG,IAAI,CAAC,QAAQ,CAAC,2BAA2B,EACvE,oBAAoB,GAAG,IAAI,CAAC,QAAQ,CAAC,oBAAoB,EACzD,oBAAoB,GAAG,IAAI,CAAC,QAAQ,CAAC,oBAAoB,GACzD,GAAG,IAAI,CAAC,QAAQ,CAAC;YAElB,KAAK;gBACJ,oBAAoB,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,GAAG,CAAC,EAAE,2BAA2B,CAAC,CAAC;YACpF,EAAE,CAAC,CAAC,KAAK,GAAG,oBAAoB,CAAC,CAAC,CAAC;gBAClC,KAAK,GAAG,oBAAoB,CAAC;YAC9B,CAAC;QACF,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;QACjC,MAAM,CAAC,KAAK,CAAC;IACd,CAAC;IAKO,WAAW,CAAC,WAAwB;QAC3C,EAAE,CAAC,CAAC,OAAO,WAAW,KAAK,QAAQ,CAAC,CAAC,CAAC;YACrC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;QACrC,CAAC;QACD,EAAE,CAAC,CAAC,OAAO,WAAW,KAAK,UAAU,CAAC,CAAC,CAAC;YACvC,MAAM,GAAG,GAAG,WAAW,EAAE,CAAC;YAC1B,EAAE,CAAC,CAAC,OAAO,GAAG,KAAK,QAAQ,CAAC,CAAC,CAAC;gBAC7B,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;YAC7B,CAAC;YACD,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;gBAC1B,MAAM,CAAC,GAAG,CAAC;YACZ,CAAC;QACF,CAAC;QACD,MAAM,KAAK,CAAC,aAAa,CAAC,CAAC;IAC5B,CAAC;IAEO,YAAY,CAAC,KAAiB;QACrC,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;QAE3B,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;YAClB,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QACrB,CAAC;QACD,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;IAC5D,CAAC;IAEO,YAAY,CAAC,KAAiB;QACrC,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;QAC1C,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,KAAK,CAAC,OAAO,KAAK,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC;QAEjF,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;YAClB,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QACrB,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,sBAAsB,CAAC,CAAC;QACpC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;QAE3D,IAAI,CAAC,QAAQ,EAAE,CAAC;IACjB,CAAC;IAEO,cAAc,CAAC,KAAmB;QACzC,IAAI,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC;QAE7B,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;YACpB,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QACvB,CAAC;QACD,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;IAC9D,CAAC;IAEO,WAAW,CAAC,KAAY;QAC/B,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;QAC1B,MAAM,EAAC,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,EAAC,GAAG,IAAI,CAAC,QAAQ,CAAC;QAE5D,YAAY,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QACnC,IAAI,CAAC,cAAc,GAAG,UAAU,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE,EAAE,SAAS,CAAC,CAAC;QAEtE,IAAI,CAAC,MAAM,CAAC,oBAAoB,CAAC,CAAC;QAElC,IAAI,CAAC,GAAI,CAAC,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC;QAExC,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;YACjB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QACpB,CAAC;QACD,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;IAC3D,CAAC;IAEO,cAAc;QACrB,IAAI,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC;QAC7B,IAAI,CAAC,YAAY,CAAC,IAAI,mBAAU,CAAC,KAAK,CAAC,SAAS,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;IAC3D,CAAC;IAEO,UAAU,CAAC,GAA6B;QAC/C,MAAM,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,GAAG,KAAK,QAAQ,IAAI,OAAO,GAAG,KAAK,UAAU,CAAC,IAAI,OAAO,GAAG,CAAC,IAAI,KAAK,UAAU,CAAC;IAC1G,CAAC;IAKO,gBAAgB;QACvB,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YACf,MAAM,CAAC;QACR,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;QAC/B,GAAG,CAAC,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,CAAC,IAAI,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC;YACnD,IAAI,CAAC,GAAG,CAAC,mBAAmB,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;QAC7C,CAAC;IACF,CAAC;IAEO,KAAK;QACZ,MAAM,CAAC,IAAI,OAAO,CAAC,OAAO,CAAC,EAAE;YAC5B,UAAU,CAAC,OAAO,EAAE,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC;QAC3C,CAAC,CAAC,CAAC;IACJ,CAAC;IAKM,gBAAgB,CACtB,IAAO,EACP,QAAiD;QAEjD,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAE3B,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACtC,CAAC;IACF,CAAC;IAMM,KAAK,CAAC,IAAa,EAAE,MAAe;QAC1C,IAAI,CAAC,gBAAgB,GAAG,KAAK,CAAC;QAC9B,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,KAAK,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;YACtD,MAAM,CAAC;QACR,CAAC;QACD,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;IAC9B,CAAC;IAEO,MAAM,CAAC,kBAAkB;QAChC,EAAE,CAAC,CAAC,OAAO,SAAS,KAAK,WAAW,CAAC,CAAC,CAAC;YAEtC,MAAM,CAAC,SAAS,CAAC;QAClB,CAAC;IACF,CAAC;IAEM,MAAM,CAAC,WAAW,CAAC,CAAM;QAC/B,MAAM,CAAC,OAAO,CAAC,KAAK,UAAU,IAAI,CAAC,CAAC,OAAO,KAAK,CAAC,CAAC;IACnD,CAAC;IAMM,SAAS,CAAC,IAAa,EAAE,MAAe;QAC9C,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;QAC7B,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC;QACtB,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,KAAK,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;YACtD,IAAI,CAAC,QAAQ,EAAE,CAAC;QACjB,CAAC;QACD,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;QAC/B,IAAI,CAAC,QAAQ,EAAE,CAAC;IACjB,CAAC;IAKM,mBAAmB,CACzB,IAAO,EACP,QAAiD;QAEjD,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAE3B,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,QAAQ,CAAC,CAAC;QAC3E,CAAC;IACF,CAAC;IAKM,IAAI,CAAC,IAAmD;QAC9D,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YACd,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACrB,CAAC;IACF,CAAC;CAuBD;AA9ZD,wCA8ZC","sourcesContent":["/*!\n * Reconnecting BaseWebSocket\n * by Pedro Ladaria <pedro.ladaria@gmail.com>\n * https://github.com/pladaria/reconnecting-websocket\n * License MIT\n */\n\nimport * as WebSocket from \"ws\";\n\nimport {CloseEvent, ErrorEvent, Event, WebSocketEventMap} from './Events';\n\n/**\n * Returns true if given argument looks like a BaseWebSocket class\n */\n\nexport interface IReconOptions {\n\tWebSocket?: any;\n\tconnectionTimeout?: number;\n\tdebug?: boolean;\n\tmaxReconnectionDelay?: number;\n\tmaxRetries?: number;\n\tminReconnectionDelay?: number;\n\tminUptime?: number;\n\treconnectionDelayGrowFactor?: number;\n}\n\nexport type UrlProvider = string | (() => string) | (() => Promise<string>);\n\nexport type ListenersMap = {\n\terror: Array<((event: ErrorEvent) => void)>;\n\tmessage: Array<((event: MessageEvent) => void)>;\n\topen: Array<((event: Event) => void)>;\n\tclose: Array<((event: CloseEvent) => void)>;\n};\n\nexport default class ReconnectingWebSocket {\n\tprivate _connectLock = false;\n\tprivate _connectTimeout: any;\n\tprivate _listeners: ListenersMap = {\n\t\terror: [],\n\t\tmessage: [],\n\t\topen: [],\n\t\tclose: [],\n\t};\n\tprivate readonly _options: IReconOptions;\n\tprivate readonly _protocols?: string | string[];\n\tprivate _shouldReconnect = true;\n\tprivate _uptimeTimeout: any;\n\tprivate readonly _url: UrlProvider;\n\tprivate _ws?: WebSocket;\n\tprivate readonly eventToHandler = new Map<keyof WebSocketEventMap, any>([\n\t\t['open', this._handleOpen.bind(this)],\n\t\t['close', this._handleClose.bind(this)],\n\t\t['error', this._handleError.bind(this)],\n\t\t['message', this._handleMessage.bind(this)],\n\t]);\n\t/**\n\t * An event listener to be called when the BaseWebSocket connection's readyState changes to CLOSED\n\t */\n\tpublic onclose?: (event: CloseEvent) => void = undefined;\n\t/**\n\t * An event listener to be called when an error occurs\n\t */\n\tpublic onerror?: (event: Event) => void = undefined;\n\t/**\n\t * An event listener to be called when a message is received from the server\n\t */\n\tpublic onmessage?: (event: MessageEvent) => void = undefined;\n\t/**\n\t * An event listener to be called when the BaseWebSocket connection's readyState changes to OPEN;\n\t * this indicates that the connection is ready to send and receive data\n\t */\n\tpublic onopen?: (event: Event) => void = undefined;\n\n\tstatic get CLOSED() {\n\t\treturn 3;\n\t}\n\n\tget CLOSED() {\n\t\treturn ReconnectingWebSocket.CLOSED;\n\t}\n\n\tstatic get CLOSING() {\n\t\treturn 2;\n\t}\n\n\tget CLOSING() {\n\t\treturn ReconnectingWebSocket.CLOSING;\n\t}\n\n\tstatic get CONNECTING() {\n\t\treturn 0;\n\t}\n\n\tget CONNECTING() {\n\t\treturn ReconnectingWebSocket.CONNECTING;\n\t}\n\n\tstatic get OPEN() {\n\t\treturn 1;\n\t}\n\n\tget OPEN() {\n\t\treturn ReconnectingWebSocket.OPEN;\n\t}\n\n\tprivate _binaryType = 'blob';\n\n\tget binaryType(): string {\n\t\treturn this._ws ? this._ws.binaryType : this._binaryType;\n\t}\n\n\tset binaryType(value: string) {\n\t\tthis._binaryType = value;\n\t\tif (this._ws) {\n\t\t\t// @ts-ignore\n\t\t\tthis._ws.binaryType = value;\n\t\t}\n\t}\n\n\tprivate _retryCount = -1;\n\n\t/**\n\t * Returns the number or connection retries\n\t */\n\tget retryCount(): number {\n\t\treturn Math.max(this._retryCount, 0);\n\t}\n\n\t/**\n\t * The number of bytes of data that have been queued using calls to send() but not yet\n\t * transmitted to the network. This value resets to zero once all queued data has been sent.\n\t * This value does not reset to zero when the connection is closed; if you keep calling send(),\n\t * this will continue to climb. Read only\n\t */\n\tget bufferedAmount(): number {\n\t\treturn this._ws ? this._ws.bufferedAmount : 0;\n\t}\n\n\t/**\n\t * The extensions selected by the server. This is currently only the empty string or a list of\n\t * extensions as negotiated by the connection\n\t */\n\tget extensions(): string {\n\t\treturn this._ws ? this._ws.extensions : '';\n\t}\n\n\t/**\n\t * A string indicating the name of the sub-protocol the server selected;\n\t * this will be one of the strings specified in the protocols parameter when creating the\n\t * BaseWebSocket object\n\t */\n\tget protocol(): string {\n\t\treturn this._ws ? this._ws.protocol : '';\n\t}\n\n\t/**\n\t * The current state of the connection; this is one of the Ready state constants\n\t */\n\tget readyState(): number {\n\t\treturn this._ws ? this._ws.readyState : ReconnectingWebSocket.CONNECTING;\n\t}\n\n\t/**\n\t * The URL as resolved by the constructor\n\t */\n\tget url(): string {\n\t\treturn this._ws ? this._ws.url : '';\n\t}\n\n\tprivate _acceptOpen() {\n\t\tthis._retryCount = 0;\n\t}\n\n\t/**\n\t * Assign event listeners to BaseWebSocket instance\n\t */\n\tprivate _addListeners() {\n\t\tthis._debug('addListeners');\n\t\tfor (const [type, handler] of this.eventToHandler) {\n\t\t\tthis._ws!.addEventListener(type, handler);\n\t\t}\n\t}\n\n\tprivate _connect() {\n\t\tif (this._connectLock) {\n\t\t\treturn;\n\t\t}\n\t\tthis._connectLock = true;\n\n\t\tconst {\n\t\t\tmaxRetries = this._options.maxRetries,\n\t\t\tconnectionTimeout = this._options.connectionTimeout,\n\t\t\tWebSocket = ReconnectingWebSocket.getGlobalWebSocket(),\n\t\t} = this._options;\n\n\t\tif (this._retryCount >= maxRetries) {\n\t\t\tthis._debug('max retries reached', this._retryCount, '>=', maxRetries);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._retryCount++;\n\n\t\tthis._debug('connect', this._retryCount);\n\t\tthis._removeListeners();\n\t\tif (!ReconnectingWebSocket.isWebSocket(WebSocket)) {\n\t\t\tthrow Error('No valid BaseWebSocket class provided');\n\t\t}\n\t\tthis._wait()\n\t\t\t.then(() => this._getNextUrl(this._url))\n\t\t\t.then(url => {\n\t\t\t\tthis._debug('connect', {url, protocols: this._protocols});\n\t\t\t\tthis._ws = new WebSocket(url, this._protocols);\n\t\t\t\t// @ts-ignore\n\t\t\t\tthis._ws!.binaryType = this._binaryType;\n\t\t\t\tthis._connectLock = false;\n\t\t\t\tthis._addListeners();\n\t\t\t\tthis._connectTimeout = setTimeout(() => this._handleTimeout(), connectionTimeout);\n\t\t\t});\n\t}\n\n\tprivate _debug(...params: any[]) {\n\t\tif (this._options.debug) {\n\t\t\t// tslint:disable-next-line\n\t\t\tconsole.log('RWS>', ...params);\n\t\t}\n\t}\n\n\tprivate _disconnect(code?: number, reason?: string) {\n\t\tclearTimeout(this._connectTimeout);\n\t\tif (!this._ws) {\n\t\t\treturn;\n\t\t}\n\t\tthis._removeListeners();\n\t\ttry {\n\t\t\tthis._ws.close(code, reason);\n\t\t\tthis._handleClose(new CloseEvent(code, reason, this));\n\t\t} catch (error) {\n\t\t\t// ignore\n\t\t}\n\t}\n\n\tprivate _getNextDelay() {\n\t\tlet delay = 0;\n\t\tif (this._retryCount > 0) {\n\t\t\tconst {\n\t\t\t\treconnectionDelayGrowFactor = this._options.reconnectionDelayGrowFactor,\n\t\t\t\tminReconnectionDelay = this._options.minReconnectionDelay,\n\t\t\t\tmaxReconnectionDelay = this._options.maxReconnectionDelay,\n\t\t\t} = this._options;\n\n\t\t\tdelay =\n\t\t\t\tminReconnectionDelay + Math.pow(this._retryCount - 1, reconnectionDelayGrowFactor);\n\t\t\tif (delay > maxReconnectionDelay) {\n\t\t\t\tdelay = maxReconnectionDelay;\n\t\t\t}\n\t\t}\n\t\tthis._debug('next delay', delay);\n\t\treturn delay;\n\t}\n\n\t/**\n\t * @return Promise<string>\n\t */\n\tprivate _getNextUrl(urlProvider: UrlProvider): Promise<string> {\n\t\tif (typeof urlProvider === 'string') {\n\t\t\treturn Promise.resolve(urlProvider);\n\t\t}\n\t\tif (typeof urlProvider === 'function') {\n\t\t\tconst url = urlProvider();\n\t\t\tif (typeof url === 'string') {\n\t\t\t\treturn Promise.resolve(url);\n\t\t\t}\n\t\t\tif (this._isPromise(url)) {\n\t\t\t\treturn url;\n\t\t\t}\n\t\t}\n\t\tthrow Error('Invalid URL');\n\t}\n\n\tprivate _handleClose(event: CloseEvent) {\n\t\tthis._debug('close event');\n\n\t\tif (this.onclose) {\n\t\t\tthis.onclose(event);\n\t\t}\n\t\tthis._listeners.close.forEach(listener => listener(event));\n\t}\n\n\tprivate _handleError(event: ErrorEvent) {\n\t\tthis._debug('error event', event.message);\n\t\tthis._disconnect(undefined, event.message === 'TIMEOUT' ? 'timeout' : undefined);\n\n\t\tif (this.onerror) {\n\t\t\tthis.onerror(event);\n\t\t}\n\t\tthis._debug('exec error listeners');\n\t\tthis._listeners.error.forEach(listener => listener(event));\n\n\t\tthis._connect();\n\t}\n\n\tprivate _handleMessage(event: MessageEvent) {\n\t\tthis._debug('message event');\n\n\t\tif (this.onmessage) {\n\t\t\tthis.onmessage(event);\n\t\t}\n\t\tthis._listeners.message.forEach(listener => listener(event));\n\t}\n\n\tprivate _handleOpen(event: Event) {\n\t\tthis._debug('open event');\n\t\tconst {minUptime = this._options.minUptime} = this._options;\n\n\t\tclearTimeout(this._connectTimeout);\n\t\tthis._uptimeTimeout = setTimeout(() => this._acceptOpen(), minUptime);\n\n\t\tthis._debug('assign binary type');\n\t\t// @ts-ignore\n\t\tthis._ws!.binaryType = this._binaryType;\n\n\t\tif (this.onopen) {\n\t\t\tthis.onopen(event);\n\t\t}\n\t\tthis._listeners.open.forEach(listener => listener(event));\n\t}\n\n\tprivate _handleTimeout() {\n\t\tthis._debug('timeout event');\n\t\tthis._handleError(new ErrorEvent(Error('TIMEOUT'), this));\n\t}\n\n\tprivate _isPromise(obj: string | Promise<string>) {\n\t\treturn !!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function';\n\t}\n\n\t/**\n\t * Remove event listeners to BaseWebSocket instance\n\t */\n\tprivate _removeListeners() {\n\t\tif (!this._ws) {\n\t\t\treturn;\n\t\t}\n\t\tthis._debug('removeListeners');\n\t\tfor (const [type, handler] of this.eventToHandler) {\n\t\t\tthis._ws.removeEventListener(type, handler);\n\t\t}\n\t}\n\n\tprivate _wait(): Promise<void> {\n\t\treturn new Promise(resolve => {\n\t\t\tsetTimeout(resolve, this._getNextDelay());\n\t\t});\n\t}\n\n\t/**\n\t * Register an event handler of a specific event type\n\t */\n\tpublic addEventListener<K extends keyof WebSocketEventMap>(\n\t\ttype: K,\n\t\tlistener: ((event: WebSocketEventMap[K]) => void),\n\t): void {\n\t\tif (this._listeners[type]) {\n\t\t\t// @ts-ignore\n\t\t\tthis._listeners[type].push(listener);\n\t\t}\n\t}\n\n\t/**\n\t * Closes the BaseWebSocket connection or connection attempt, if any. If the connection is already\n\t * CLOSED, this method does nothing\n\t */\n\tpublic close(code?: number, reason?: string) {\n\t\tthis._shouldReconnect = false;\n\t\tif (!this._ws || this._ws.readyState === this.CLOSED) {\n\t\t\treturn;\n\t\t}\n\t\tthis._ws.close(code, reason);\n\t}\n\n\tprivate static getGlobalWebSocket(): WebSocket | undefined {\n\t\tif (typeof WebSocket !== 'undefined') {\n\t\t\t// @ts-ignore\n\t\t\treturn WebSocket;\n\t\t}\n\t}\n\n\tpublic static isWebSocket(w: any) {\n\t\treturn typeof w === 'function' && w.CLOSING === 2;\n\t}\n\n\t/**\n\t * Closes the BaseWebSocket connection or connection attempt and connects again.\n\t * Resets retry counter;\n\t */\n\tpublic reconnect(code?: number, reason?: string) {\n\t\tthis._shouldReconnect = true;\n\t\tthis._retryCount = -1;\n\t\tif (!this._ws || this._ws.readyState === this.CLOSED) {\n\t\t\tthis._connect();\n\t\t}\n\t\tthis._disconnect(code, reason);\n\t\tthis._connect();\n\t}\n\n\t/**\n\t * Removes an event listener\n\t */\n\tpublic removeEventListener<K extends keyof WebSocketEventMap>(\n\t\ttype: K,\n\t\tlistener: ((event: WebSocketEventMap[K]) => void),\n\t): void {\n\t\tif (this._listeners[type]) {\n\t\t\t// @ts-ignore\n\t\t\tthis._listeners[type] = this._listeners[type].filter(l => l !== listener);\n\t\t}\n\t}\n\n\t/**\n\t * Enqueues the specified data to be transmitted to the server over the BaseWebSocket connection\n\t */\n\tpublic send(data: string | ArrayBuffer | Blob | ArrayBufferView) {\n\t\tif (this._ws) {\n\t\t\tthis._ws.send(data);\n\t\t}\n\t}\n\n\tconstructor(url: UrlProvider, options: IReconOptions = {}, protocols?: string | string[]) {\n\t\tthis._url = url;\n\t\tthis._protocols = protocols;\n\t\tthis._options = options;\n\t\tthis._connect();\n\n\t\tif (Object.keys(options).length === 0) {\n\t\t\tthis._options = <IReconOptions>{\n\t\t\t\tmaxReconnectionDelay: 10000,\n\t\t\t\tminReconnectionDelay: 1000 + Math.random() * 4000,\n\t\t\t\tminUptime: 5000,\n\t\t\t\treconnectionDelayGrowFactor: 1.3,\n\t\t\t\tconnectionTimeout: 4000,\n\t\t\t\tmaxRetries: Infinity,\n\t\t\t\tdebug: false,\n\t\t\t};\n\t\t} else {\n\t\t\tthis._options = options;\n\t\t}\n\t}\n\n}"]}